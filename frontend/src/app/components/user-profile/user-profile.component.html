<div class="profile-container">
    <div class="profile-header">
        <h1>My Profile</h1>
        <p>Manage your personal information and account settings</p>
    </div>

    <div *ngIf="loading" class="loading">Loading...</div>

    <div *ngIf="!loading && user" class="profile-content">
        <!-- User Info Card -->
        <div class="info-card">
            <div class="card-header">
                <h2>Personal Information</h2>
            </div>

            <!-- Name -->
            <div class="info-row">
                <div class="info-label">Name</div>
                <div class="info-value" *ngIf="!editingName">
                    <span>{{ user.name }}</span>
                    <button class="btn-edit" (click)="editingName = true">Edit</button>
                </div>
                <div class="edit-form" *ngIf="editingName">
                    <input type="text" [(ngModel)]="nameForm.name" placeholder="Name">
                    <div class="form-actions">
                        <button class="btn-save" (click)="updateName()">Save</button>
                        <button class="btn-cancel" (click)="cancelEdit('name')">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Username -->
            <div class="info-row">
                <div class="info-label">Username</div>
                <div class="info-value" *ngIf="!editingUsername">
                    <span>{{ user.username }}</span>
                    <button class="btn-edit" (click)="editingUsername = true">Edit</button>
                </div>
                <div class="edit-form" *ngIf="editingUsername">
                    <input type="text" [(ngModel)]="usernameForm.username" placeholder="Username">
                    <div class="form-actions">
                        <button class="btn-save" (click)="updateUsername()">Save</button>
                        <button class="btn-cancel" (click)="cancelEdit('username')">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Email (read-only) -->
            <div class="info-row">
                <div class="info-label">Email</div>
                <div class="info-value">
                    <span>{{ user.email }}</span>
                    <span class="read-only-badge">Read only</span>
                </div>
            </div>

            <!-- Subscription -->
            <div class="info-row">
                <div class="info-label">Subscription</div>
                <div class="info-value">
                    <span class="subscription-badge">{{ user.subscription_role | uppercase }}</span>
                    <span class="expiry-date" *ngIf="user.subscription_expires_at">
                        Expires: {{ user.subscription_expires_at | date:'dd/MM/yyyy' }}
                    </span>
                </div>
            </div>
        </div>

        <!-- Password Card -->
        <div class="info-card">
            <div class="card-header">
                <h2>Security</h2>
            </div>

            <div class="info-row">
                <div class="info-label">Password</div>
                <div class="info-value" *ngIf="!editingPassword">
                    <span>••••••••</span>
                    <button class="btn-edit" (click)="editingPassword = true">Change</button>
                </div>
                <div class="edit-form password-form" *ngIf="editingPassword">
                    <input type="password" [(ngModel)]="passwordForm.currentPassword" placeholder="Current password">
                    <input type="password" [(ngModel)]="passwordForm.newPassword" placeholder="New password">
                    <input type="password" [(ngModel)]="passwordForm.confirmPassword" placeholder="Confirm password">
                    <div class="form-actions">
                        <button class="btn-save" (click)="updatePassword()">Save</button>
                        <button class="btn-cancel" (click)="cancelEdit('password')">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="danger-card">
            <div class="card-header">
                <h2>Danger Zone</h2>
            </div>

            <div class="danger-content">
                <div class="danger-info">
                    <h3>Delete Account</h3>
                    <p>Once your account is deleted, there is no going back. Please be certain.</p>
                </div>
                <button class="btn-danger" (click)="showDeleteConfirm = true" *ngIf="!showDeleteConfirm">
                    Delete Account
                </button>

                <div class="delete-confirm" *ngIf="showDeleteConfirm">
                    <p>Type <strong>{{ user.username }}</strong> to confirm:</p>
                    <input type="text" [(ngModel)]="deleteConfirmText" placeholder="Username">
                    <div class="form-actions">
                        <button class="btn-danger" (click)="deleteAccount()">Confirm Deletion</button>
                        <button class="btn-cancel"
                            (click)="showDeleteConfirm = false; deleteConfirmText = ''">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>