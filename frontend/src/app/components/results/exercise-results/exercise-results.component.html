<div class="results-layout" *ngIf="result">
    <div class="main-content">
        <header class="results-header">
            <div class="breadcrumb">
                <a routerLink="/">Home</a> <span class="separator">›</span>
                <a routerLink="/attempts">Attempts</a> <span class="separator">›</span>
                <span class="current">Results</span>
            </div>

            <h1 class="page-title">Results: {{ exercise?.Subcategory?.name }}</h1>
            <div class="meta-info" *ngIf="result.created_at">
                Completed on {{ result.created_at | date:'MMMM d, yyyy' }} at {{ result.created_at | date:'h:mm a' }}
            </div>
        </header>

        <div class="stats-container">
            <div class="stat-card score-card">
                <div class="stat-content">
                    <span class="label">SCORE</span>
                    <div class="score-value">{{ scorePercentage }}%</div>
                    <div class="badge" [class.pass]="scorePercentage >= 50" [class.fail]="scorePercentage < 50">
                        {{ scorePercentage >= 50 ? 'Passed' : 'Failed' }}
                    </div>
                </div>
                <div class="circle-progress" [style.--percent]="scorePercentage">
                    <svg viewBox="0 0 36 36">
                        <path class="circle-bg"
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" [attr.stroke-dasharray]="scorePercentage + ', 100'"
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                    </svg>
                </div>
            </div>

            <div class="stat-card">
                <div class="icon-check">✓</div>
                <div class="stat-text">
                    <span class="label">Correct</span>
                    <div class="value">{{ result.correct_gaps }}</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="icon-cross">✕</div>
                <div class="stat-text">
                    <span class="label">Mistakes</span>
                    <div class="value">{{ result.total_gaps - result.correct_gaps }}</div>
                </div>
            </div>
        </div>

        <h2 class="section-title">Detailed Review</h2>

        <router-outlet></router-outlet>

    </div>

    <aside class="sidebar">
        <div class="ai-card">
            <div class="ai-icon">
                <img src="../svg/lights.svg" alt="AI Icon">
            </div>
            <h3>Doubts about errors?</h3>
            <p>Get a detailed and personalized explanation of your mistakes with our AI.</p>
            <button class="ai-btn" (click)="explainWithIA()" [disabled]="isAnalyzing">
                <span class="btn-icon"></span> {{ isAnalyzing ? 'Analyzing...' : 'Explain with AI' }}
            </button>
        </div>
        <button class="back-btn" routerLink="/attempts">
            <span class="btn-icon">↩</span> Back to attempts
        </button>
        <div class="ai-analysis-card" *ngIf="isAnalyzing || structuredExplanation || htmlExplanation">
            <div class="card-header">
                AI ANALYSIS <span class="version">v2.4</span>
            </div>
            <div class="analysis-content">
                <div *ngIf="isAnalyzing" class="ai-loading">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <div *ngIf="structuredExplanation" class="structured-explanation">
                    <p class="general-feedback">{{ structuredExplanation.general_feedback }}</p>

                    <div class="corrections-list">
                        <div class="correction-item" *ngFor="let correction of structuredExplanation.corrections">
                            <div class="correction-header">
                                <span class="q-id">Gap {{ correction.question_id }}</span>
                                <span class="status-badge" [class.correct]="correction.status === 'correct'"
                                    [class.incorrect]="correction.status === 'incorrect'">{{ correction.status |
                                    uppercase }}</span>
                            </div>
                            <div class="correction-body">
                                <p class="explanation-text">{{ correction.explanation }}</p>
                                <div class="comparison" *ngIf="correction.status === 'incorrect'">
                                    <div class="u-ans">❌ {{ correction.user_answer }}</div>
                                    <div class="c-ans">✅ {{ correction.correct_answer }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <p *ngIf="htmlExplanation" class="analysis-text" [innerHTML]="htmlExplanation"></p>
            </div>
        </div>




    </aside>

</div>