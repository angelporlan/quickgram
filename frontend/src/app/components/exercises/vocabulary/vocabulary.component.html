<div class="exercise-overlay">
    <header class="exercise-header">
        <button class="back-btn" (click)="close.emit()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Exit
        </button>
        <div class="header-center">
            <span class="header-title">QuickGram</span>
        </div>
        <div class="progress-info">
            Question {{ answeredGaps }} of {{ totalGaps }}
        </div>
    </header>

    <div class="progress-bar-container">
        <div class="progress-bar" [style.width.%]="progressPercentage"></div>
    </div>

    <div class="exercise-body">
        <div class="content-wrapper">
            <h1>Vocabulary Practice</h1>
            <p class="subtitle">Fill in the Blanks - Word Bank</p>

            <div class="split-view">
                <div class="text-area card">
                    <div class="text-content">
                        <ng-container *ngFor="let part of textParts">
                            <span *ngIf="part.type === 'text'" [innerHTML]="part.content"></span>
                            <span *ngIf="part.type === 'gap'" class="gap-marker"
                                [class.active]="currentGapId === part.id" [class.answered]="userAnswers.has(part.id)"
                                (click)="selectGap(part.id)">
                                <span class="gap-number">{{ part.id }}</span>
                                <span class="gap-value" *ngIf="userAnswers.has(part.id)">{{ userAnswers.get(part.id)
                                    }}</span>
                                <span class="gap-placeholder" *ngIf="!userAnswers.has(part.id)">?</span>
                            </span>
                        </ng-container>
                    </div>
                </div>

                <div class="options-area">
                    <div class="question-card" *ngIf="currentGapId">
                        <div class="enunciado">
                            <img src="../svg/light-bulb-on.svg" alt="lamp-icon" class="lamp-icon">
                            <div class="enunciado-text">
                                <span class="label">INSTRUCTION</span>
                                <p>Select the correct word from the word bank to complete the gap {{ currentGapId }}.
                                </p>
                            </div>
                            <div class="big-question-mark">?</div>
                        </div>

                        <div class="word-bank-container">
                            <label class="input-label">Word Bank:</label>
                            <div class="word-bank">
                                <button *ngFor="let word of availableWords" class="word-chip"
                                    [class.used]="isWordUsed(word)" [class.selected]="currentAnswer === word"
                                    (click)="selectWord(word)" [disabled]="isWordUsed(word) && currentAnswer !== word">
                                    {{ word }}
                                </button>
                            </div>
                            <p class="input-hint">Click on a word to select it</p>
                        </div>

                        <button class="submit-btn" (click)="submit()" [disabled]="!allQuestionsAnswered">
                            Submit Answer
                        </button>
                    </div>

                    <div class="empty-state" *ngIf="!currentGapId">
                        <p>Select a gap in the text to write your answer.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>