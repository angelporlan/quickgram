<div class="exercise-overlay">
    <header class="exercise-header">
        <button class="back-btn" (click)="close.emit()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Salir
        </button>
        <div class="header-center">
            <span class="logo-icon">ðŸŽ“</span>
            <span class="header-title">English B2 Prep</span>
        </div>
        <div class="progress-info">
            Pregunta {{ answeredGaps }} de {{ totalGaps }}
        </div>
    </header>

    <div class="progress-bar-container">
        <div class="progress-bar" [style.width.%]="progressPercentage"></div>
    </div>

    <div class="exercise-body">
        <div class="content-wrapper">
            <h1>Vocabulary Practice</h1>
            <p class="subtitle">Fill in the Blanks - Word Bank</p>

            <div class="split-view">
                <div class="text-area card">
                    <div class="text-content">
                        <ng-container *ngFor="let part of textParts">
                            <span *ngIf="part.type === 'text'" [innerHTML]="part.content"></span>
                            <span *ngIf="part.type === 'gap'" class="gap-marker"
                                [class.active]="currentGapId === part.id" [class.answered]="userAnswers.has(part.id)"
                                (click)="selectGap(part.id)">
                                <span class="gap-number">{{ part.id }}</span>
                                <span class="gap-value" *ngIf="userAnswers.has(part.id)">{{ userAnswers.get(part.id)
                                    }}</span>
                                <span class="gap-placeholder" *ngIf="!userAnswers.has(part.id)">?</span>
                            </span>
                        </ng-container>
                    </div>
                </div>

                <div class="options-area">
                    <div class="question-card" *ngIf="currentGapId">
                        <div class="enunciado">
                            <div class="lamp-icon">ðŸ’¡</div>
                            <div class="enunciado-text">
                                <span class="label">INSTRUCCIÃ“N</span>
                                <p>Selecciona la palabra correcta del banco de palabras para completar el hueco {{
                                    currentGapId }}.</p>
                            </div>
                            <div class="big-question-mark">?</div>
                        </div>

                        <div class="word-bank-container">
                            <label class="input-label">Banco de Palabras:</label>
                            <div class="word-bank">
                                <button *ngFor="let word of availableWords" class="word-chip"
                                    [class.used]="isWordUsed(word)" [class.selected]="currentAnswer === word"
                                    (click)="selectWord(word)" [disabled]="isWordUsed(word) && currentAnswer !== word">
                                    {{ word }}
                                </button>
                            </div>
                            <p class="input-hint">Haz clic en una palabra para seleccionarla</p>
                        </div>

                        <button class="submit-btn" (click)="submit()" [disabled]="!allQuestionsAnswered">
                            Enviar Respuesta
                        </button>
                    </div>

                    <div class="empty-state" *ngIf="!currentGapId">
                        <p>Selecciona un hueco en el texto para elegir una palabra.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>