<div class="gapped-container">
    <header class="exercise-header">
        <button class="back-btn" (click)="close.emit()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Exit
        </button>
        <div class="header-center">
            <span class="header-title">QuickGram</span>
        </div>
        <div class="progress-info">
            Question {{ answeredCount }} of {{ gaps.length }}
        </div>
    </header>

    <div class="progress-bar-container">
        <div class="progress-bar" [style.width.%]="progressPercentage"></div>
    </div>

    <div class="content-wrapper">
        <div class="left-column">
            <div class="instructions-section">
                <h2 class="section-title">Instructions</h2>
                <p class="instructions-text">{{ instructions }}</p>
            </div>

            <div class="reading-section">
                <h2 class="section-title">Text</h2>
                <div class="reading-text">
                    <div class="text-with-gaps">
                        <ng-container *ngFor="let part of getTextWithGaps()">
                            <span *ngIf="!part.startsWith('GAP_')" class="text-part">{{ part }}</span>
                            <span *ngIf="part.startsWith('GAP_')" class="gap-placeholder">
                                <span class="gap-number">({{ part.replace('GAP_', '') }})</span>
                                <span class="gap-content" [class.filled]="userAnswers[+part.replace('GAP_', '')]">
                                    {{ userAnswers[+part.replace('GAP_', '')] || '...........' }}
                                </span>
                            </span>
                        </ng-container>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-column">
            <div class="sentences-section">
                <h2 class="section-title">Sentences Available</h2>
                <p class="helper-text">Click on a sentence and then on the gap where you want to place it</p>

                <div class="sentences-list">
                    <div class="sentence-card" *ngFor="let sentence of availableSentences | keyvalue"
                        [class.used]="isSentenceUsed(sentence.key)"
                        (click)="!isSentenceUsed(sentence.key) && selectedSentence = sentence.key"
                        [class.selected]="selectedSentence === sentence.key">
                        <span class="sentence-key">{{ sentence.key }}</span>
                        <span class="sentence-text">{{ sentence.value }}</span>
                    </div>
                </div>

                <div class="gaps-selector">
                    <h3 class="selector-title">Select the gap:</h3>
                    <div class="gaps-grid">
                        <button class="gap-btn" *ngFor="let gap of gaps" [class.filled]="userAnswers[gap]"
                            [disabled]="!selectedSentence"
                            (click)="selectedSentence && selectSentence(gap, selectedSentence); selectedSentence = null">
                            {{ gap }}
                            <span class="gap-value" *ngIf="userAnswers[gap]">({{ userAnswers[gap] }})</span>
                        </button>
                    </div>
                </div>

                <div class="submit-section">
                    <button class="submit-btn" (click)="submit()" [disabled]="!allGapsFilled">
                        Submit Answers
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>