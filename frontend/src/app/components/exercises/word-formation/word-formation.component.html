<div class="exercise-overlay">
    <header class="exercise-header">
        <button class="back-btn" (click)="close.emit()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Salir
        </button>
        <div class="header-center">
            <span class="logo-icon">ðŸŽ“</span>
            <span class="header-title">English B2 Prep</span>
        </div>
        <div class="progress-info">
            Pregunta {{ answeredGaps }} de {{ totalGaps }}
        </div>
    </header>

    <div class="progress-bar-container">
        <div class="progress-bar" [style.width.%]="progressPercentage"></div>
    </div>

    <div class="exercise-body">
        <div class="content-wrapper">
            <h1>Grammar Practice</h1>
            <p class="subtitle">Word Formation - Transform the Base Words</p>

            <div class="split-view">
                <div class="text-area card">
                    <div class="text-content">
                        <ng-container *ngFor="let part of textParts">
                            <span *ngIf="part.type === 'text'" [innerHTML]="part.content"></span>
                            <span *ngIf="part.type === 'gap'" class="gap-marker"
                                [class.active]="currentGapId === part.id" [class.answered]="userAnswers.has(part.id)"
                                (click)="selectGap(part.id)">
                                <span class="gap-number">{{ part.id }}</span>
                                <span class="gap-value" *ngIf="userAnswers.has(part.id)">{{ userAnswers.get(part.id)
                                    }}</span>
                                <span class="gap-placeholder" *ngIf="!userAnswers.has(part.id)">?</span>
                                <span class="base-word">({{ part.baseWord }})</span>
                            </span>
                        </ng-container>
                    </div>
                </div>

                <div class="options-area">
                    <div class="question-card" *ngIf="currentGapId">
                        <div class="enunciado">
                            <div class="lamp-icon">ðŸ’¡</div>
                            <div class="enunciado-text">
                                <span class="label">INSTRUCCIÃ“N</span>
                                <p>Transforma la palabra base <strong>{{ currentBaseWord }}</strong> en la forma
                                    correcta para completar el hueco {{ currentGapId }}.</p>
                            </div>
                            <div class="big-question-mark">?</div>
                        </div>

                        <div class="base-word-hint">
                            <span class="hint-label">PALABRA BASE:</span>
                            <span class="hint-word">{{ currentBaseWord }}</span>
                        </div>

                        <div class="input-area">
                            <label class="input-label">Tu respuesta:</label>
                            <input type="text" class="answer-input" [value]="currentAnswer"
                                (input)="onInputChange($any($event.target).value)"
                                placeholder="Escribe la forma correcta aquÃ­..." autocomplete="off" />
                            <p class="input-hint">Presiona Enter o haz clic en otro hueco para continuar</p>
                        </div>

                        <button class="submit-btn" (click)="submit()" [disabled]="!allQuestionsAnswered">
                            Enviar Respuesta
                        </button>
                    </div>

                    <div class="empty-state" *ngIf="!currentGapId">
                        <p>Selecciona un hueco en el texto para escribir tu respuesta.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>